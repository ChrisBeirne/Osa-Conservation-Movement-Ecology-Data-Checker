---
title: "SCBI Tree Disease Guide"
output: pdf_document
author: Isabella Dangler & Kristina J. Anderson-Teixeira

header-includes:  \usepackage{float}
                  \usepackage{caption}
                  \captionsetup[figure]{labelformat=empty}
                  \captionsetup[table]{labelformat=empty}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## pull tree species ecology from GitHub and for species names, life form, and IUCN status 
tree_sp_ecology<-read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/SCBI-ForestGEO-Data/master/species_lists/Tree%20ecology/SCBI_ForestGEO_sp_ecology.csv")
tree_index <- tree_sp_ecology$life_form == "tree" | tree_sp_ecology$life_form == "small tree" | tree_sp_ecology$life_form == "shrub or small tree" # index for trees (trees and small trees)

  
# read in and manipulate tree- disease matrix
TDmatrix <- read.csv("matrix.csv")
n_FIP_by_species <- colSums (TDmatrix[3:ncol(TDmatrix)], na.rm = FALSE, dims = 1) #number of forest insects & pathogens
n_EFIP_by_species <- colSums (TDmatrix[which(TDmatrix$exotic==1),3:ncol(TDmatrix)], na.rm = FALSE, dims = 1) #number of exotic forest insects & pathogens
tree_indexTD <- c(TRUE, TRUE, tree_index)
TDmatrix <- TDmatrix[,which(tree_indexTD)] # include only trees

# read in and manipulate tree_species_summary
tree_species_summary <- read.csv("tree_species_summary.csv")
## fill in numbers of pests/pathogens from matrix
tree_species_summary[,4]<-n_FIP_by_species
tree_species_summary[,5]<-n_EFIP_by_species
tree_species_summary[,2]<-tree_sp_ecology$IUCN_red_list_status
write.csv(tree_species_summary, "tree_species_summary.csv", row.names = FALSE) # re-save file with latest numbers
tree_species_summary <- tree_species_summary [which(tree_index),] # include only trees
```

# Introduction

The aim of this guide is to identify tree species of concern within the SCBI ForestGEO plot, and the diseases that are most likely to affect them, so that we can properly identify the causes of decline.

# Methods & Definitions

## Tree species concern levels

We assigned concern levels -- high (H), moderate (M), or low (L) -- to each tree species based on results of the SCBI ForestGEO mortality census, IUCN status, and the presence and lethally of pest and pathogen species.

Concern level based on observed tree mortality rates alone was defined as follows:

Concern level based on the fraction of alive but unhealthy ("AU" status) trees observed in the latest census was defined as follows:

Overall concern level was determined as follows:

1. If IUCN Red List status was anything other than "Least Concern", the species was flagged as high concern
2. If an exotic pest or disease with high / moderate lethality was known to be present in region, any species affected by that pest/ disease was flagged as H/M concern.
3. If either mortality rate or AU concern level was M or H, overall concern was assigned to match the highest concern level, but lowered one level in the case of species with <50 individuals in the plot and only one M or H ranking.
4. If IUCN Red List status was anything other than "Least Concern", there were no known highly lethal exotic pests or diseases present, and both mortality and AU concern levels were low, the species was flagged as low concern.

## Identifying tree species - disease pairs

\newpage
# Tree Species of Concern
**Table 1. Summary of the health/ mortality status of all tree species in the SCBI ForestGEO plot.** Included is IUCN status, n of living individuals in the SCBI ForestGEO plot, numbers of known species of forest insects or pathogens (FIP) and exotic FIP (EFIP) affecting the species, levels of concern based on mortality rates and "alive-unhealthy" (AU) status, and overall level of concern based on these metrics. Codes: H = high, M = moderate; L = low. Tree species codes are defined in the document [SCBI_ForestGEO_sp_ecology.csv](https://github.com/SCBI-ForestGEO/SCBI-ForestGEO-Data/blob/master/species_lists/Tree%20ecology/SCBI_ForestGEO_sp_ecology.csv).
```{r tree_species_summary , echo=FALSE}

names(tree_species_summary) <- stringr::str_replace_all(names(tree_species_summary), "\\.", " ")
tree_species_summary[is.na(tree_species_summary)]<- "" #replace NAs with blanks

library(knitr)
library(kableExtra)
knitr::kable(tree_species_summary,
             format = "latex", booktabs = TRUE,  escape = F, longtable = TRUE,row.names = F) %>%
  kableExtra::kable_styling(full_width = TRUE, latex_options=c("repeat_header")) %>%
  add_header_above(c( " "= 5, "2021 concern level"=3 )) %>%
  column_spec(1, width = "1cm") %>% 
  column_spec(2, width = "4cm") %>% 
  column_spec(3:8, width = "1.2cm") %>% 
  row_spec(1:nrow(tree_species_summary)-1,hline_after=T) %>%
  row_spec(which(tree_species_summary$overall=="H"),  bold = T, color = "red") %>%
  row_spec(which(tree_species_summary$overall=="M"),  bold = T, color = "orange") %>%
  kable_styling(bootstrap_options = "striped", font_size = 9) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 


```

\newpage
# Tree- Disease Matrix
**Table 2. Matrix of forest insects and pathogens likely to occur at the SCBI ForestGEO plot, and the tree taxa they affect.** Tree species codes are defined in the document [SCBI_ForestGEO_sp_ecology.csv](https://github.com/SCBI-ForestGEO/SCBI-ForestGEO-Data/blob/master/species_lists/Tree%20ecology/SCBI_ForestGEO_sp_ecology.csv).
```{r matrix , echo=FALSE}

break_row = ceiling((ncol(TDmatrix)-2)/2)
TDmrowsum1 <- rowSums(TDmatrix[,3:break_row])
TDmrowsum2 <- rowSums(TDmatrix[,(break_row+1):ncol(TDmatrix)])
TDmatrix1 <- TDmatrix[TDmrowsum1>0,1:break_row]
TDmatrix2 <- TDmatrix[TDmrowsum2>0,c(1:2,(break_row+1):ncol(TDmatrix))]

TDconcern_index=paste0("",tree_species_summary$overall)
TDconcern_index1 <- TDconcern_index[1:(break_row-1)]
TDconcern_index2 <- TDconcern_index[c(1,(break_row-1):(ncol(TDmatrix)-2))]

library(knitr)
library(kableExtra)
knitr::kable(TDmatrix1[2:ncol(TDmatrix1)],
             caption = "Part 1/2: Tree species codes ACNE-FRPE",
             format = "latex", booktabs = TRUE,  escape = F, longtable = TRUE,row.names = F) %>%
  kableExtra::kable_styling(full_width = TRUE, latex_options=c("repeat_header")) %>%
  row_spec(0, bold = F, angle = 90) %>%
  row_spec(which(TDmatrix1$exotic==1), bold = TRUE) %>%
  row_spec(1:nrow(TDmatrix1)-1,hline_after=T) %>%
  column_spec(1, width = "5.27cm") %>% 
  column_spec(2:ncol(TDmatrix1), width = ".03cm", border_left = F) %>%
  column_spec(which(TDconcern_index1=="H"),  color = "red") %>%
  column_spec(which(TDconcern_index1=="M"),  color = "orange") %>%
  kable_styling(bootstrap_options = "striped", font_size = 9) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 


```
\newpage

```{r matrix2 , echo=FALSE}


knitr::kable(TDmatrix2[2:ncol(TDmatrix2)],
             caption = "Part 2/2: Tree species codes JUCI-ULRU",
             format = "latex", booktabs = TRUE,  escape = F, longtable = TRUE,row.names = F) %>%
  kableExtra::kable_styling(full_width = TRUE, latex_options=c("repeat_header")) %>%
  row_spec(0, bold = F, angle = 90) %>%
  row_spec(which(TDmatrix2$exotic==1), bold = TRUE) %>%
  row_spec(1:nrow(TDmatrix2)-1,hline_after=T) %>%
  column_spec(1, width = "5.27cm") %>% 
  column_spec(2:ncol(TDmatrix2), width = ".03cm", border_left = F) %>%
  column_spec(which(TDconcern_index2=="H"),  color = "red") %>%
  column_spec(which(TDconcern_index2=="M"),  color = "orange") %>%
  kable_styling(bootstrap_options = "striped", font_size = 9) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 

  
```

